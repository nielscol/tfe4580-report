\subsection{Digital, discretized PLL Model}
Based on the continuous PLL theory, a model for digital, discretized PLLs (i.e. ADPLLs) can be adapted. The general approach here is to utilize the bilinear transformation between continuous s-domain models to the discrete z-domain models. As commonly cited in PLL literature from a seminal paper by Gardner \cite{gardner_1980}, if the sampling frequency $f_s > 10\cdot\textnormal{BW}_{loop}$, where BW$_{loop}$ is the PLL loop bandwidth, the effects of time sampling are easily ignored for purposes of analysis. Thus the design methods established in this paper are predicated on $f_s > 10\cdot\textnormal{BW}_{loop}$.
\begin{figure}[htb!]
	\center\include{./figs/basic_adpll}
	\caption{Basic ADPLL.}
	\label{fig:basic_adpll}
\end{figure}
\FloatBarrier
The basic architecture of an ADPLL is shown in figure \ref{fig:basic_adpll}. Here, compared to the continuous PLL, the phase detector has been replaced with a time to digital converter (TDC), the loop filter $\mathrm{H}_{LF}(s)$ with a discrete loop filter $\mathrm{H}_{LF}(z)$, and the VCO with a digitally controlled oscillator (DCO). In this architecture, the TDC, loop filter, and DCO are digital. 

\subsubsection{Divider}
A digital divider behaves nearly identical to the continuous case:
\begin{equation}
	\Phi_{div}[n] = \frac{\Phi_{out}[n]}{\mathrm{N}}
\end{equation}
Application of the z-transfrom:
\begin{equation}
	\frac{\Phi_{div}(z)}{\Phi_{out}(z)} = \frac{1}{\mathrm{N}}
\end{equation}
\subsubsection{TDC}
The TDC is a digital, quantized representation of the the phase detector. It takes input phase signals $\Phi_{div}$[n] and $\Phi_{ref}$[n], and outputs a digital phase error measurement word $e_\Phi[n]$. Figure \ref{fig:tdc} shows the basic TDC model architecture. A TDC will have limited resolution in phase, equivalent to M steps per reference cycle. This is a minimum step size in time of $\Delta t_{step}$ = $1/Mf_{ref}$. Since the output of the TDC is digital, the model applies a scale factor M$/2\pi$ and floor rounding, so 1 LSB of $e_\Phi[n]$ equates to $\Delta t_{step}$ timing error  between $\Phi_{div}$[n] and $\Phi_{ref}$[n].
\begin{figure}[htb!]
	\center\include{./figs/tdc}
	\caption{TDC model.}
	\label{fig:tdc}
\end{figure}
\begin{equation}
	e_\Phi[n] = \left\lfloor\frac{\mathrm{M}}{2\pi}(\Phi_{ref}[n] - \Phi_{div}[n])\right\rfloor
\end{equation}
For purposes of PLL transfer function calculation, the z-domain representation is as follows. Effects of quantization will be handled in section \ref{pn_theory}.
\begin{equation}
	e_\Phi(z) = \frac{\mathrm{M}}{2\pi}(\Phi_{ref}(z) - \Phi_{div}(z))
\end{equation}	
\FloatBarrier
\subsubsection{Loop Filter}
The loop filter design will be derived from the continuous PI-controller loop filter with optional peaking compensation (equation \ref{eq:pi_compensated_tf}) via application of the bilinear transform. The bilinear transform specifically allows for the conversion of a continuous transfer function to discrete representation, and vice versa. This, however is conditioned on satisfaction of Nyquist sampling criteria, and in the case of PLLs it is recommended that $f_s > 10\cdot\mathrm{BW}_{loop}$ to ensure transformation accuracy \cite{gardner_1980}. A high level of oversampling allows for the following definition of the bilinear transform, where 1/T=$f_{ref}$:
\begin{align*}
	z^{-1} &= e^{-sT} && \text{(definition of z-space)} \\
	&= \sum_{k=0}^\infty\frac{(-sT)^k}{k!} && \text{(exponential Taylor series)} \\
	&\approx 1-sT &&\text{(if $|sT| = 2\pi\mathrm{BW}_{loop}\cdot T << 1$)} \\
\end{align*}
Thus the bilinear transform identities are:
\begin{align}
	z^{-1} &= 1-sT\\
	s &= \frac{1}{T}(1-z^{-1}) \label{eq:s_to_z}
\end{align}
Applying \ref{eq:s_to_z} to equation \ref{eq:pi_compensated_tf} yields the z-domain loop filter:
\begin{align}
	\textnormal{H}_{LF}(z) = \left.\textnormal{H}_{LF}(s)\right\vert_{s=\frac{1}{T}(1-z^{-1})} = \left.\frac{K_i}{s}\frac{\left(\frac{s}{\omega_z} + 1\right)}{\left(\frac{s}{\omega_p} + 1\right)}\right\vert_{s=\frac{1}{T}(1-z^{-1})}\\
	= \frac{\omega_p}{\omega_z}\frac{k_iT}{(1-z^{-1})}\frac{(1+\omega_zT)-z^{-1}}{(1+\omega_pT) - z^{-1}(2+\omega_pT) + z^{-2}}\label{eq:z_lf}
\end{align}
Equation \ref{eq:z_lf} is converted to a digitally implementable representation via converting into the canonical representation of \ref{eq:canonical_z}, which determines the tap coefficients for the sampled-time difference equation \ref{eq:cananical_diff}. 
\begin{align}
	\textnormal{H}_{LF}(z) &= \frac{\sum_{j=0}^M b_jz^{-j}}{1+\sum_{k=1}^N a_kz^{-k}}\label{eq:canonical_z} \\
	y[n]&= -\sum_{k=1}^N a_ky[n-k] + \sum_{j=0}^M b_jx[n-j] \label{eq:cananical_diff}
\end{align}
Equation \ref{eq:cananical_diff} is directly implementable in digital hardware with a direct type 1 IIR filter shown in figure \ref{fig:filt_imple}, with the filter coefficients given by equations \ref{eq:a1}-\ref{eq:b1}. The filter coefficients must be quantized into finite resolution fixed point words for a complete digital implementation. Effects of quantization will be discussed in section \ref{pn_theory}.
\begin{figure}[htb!]
	\center\include{./figs/filter_arch_tex}
	\caption{Implementation of filter.}
	\label{fig:filt_imple}
\end{figure}
			% y[n] = x[n]\frac{K_i\omega_pT}{\omega_z}\frac{1+\omega_zT}{1+\omega_pT} - x[n-1]\frac{K_i\omega_pT}{\omega_z}\frac{1}{1+\omega_pT} + y[n-1]\frac{2+\omega_pT}{1+\omega_pT} - y[n-2]\frac{1}{1+\omega_pT}\\
			% = a_0x[n] + a_1x[n-1] - b_1y[n-1] - b_2x[n-2] 
\begin{align}
	a_1 &= -\frac{2+\omega_pT}{1+\omega_pT}\label{eq:a1}\\
	a_2 &= \frac{1}{1+\omega_pT} \\
	b_0 &= \frac{K_i\omega_pT}{\omega_z}\frac{1+\omega_zT}{1+\omega_pT}\\
	b_1 &= \frac{K_i\omega_pT}{\omega_z}\frac{1}{1+\omega_pT}\label{eq:b1}
\end{align}
\subsubsection{DCO}
The DCO is modeled in discrete time as a recursive phase integrator, dependent on the DCO gain $K_{DCO}$, which provides the frequency tuning per LSB of the oscillator, the input oscillator tuning word u[n], and the sampling period T.
\begin{equation}
	\Phi_{out}[n] = \Phi_{out}[n-1] + 2\pi K_{DCO}u[n]T
\end{equation}
Application of the z-transform yields:
\begin{equation}
	\frac{\Phi_{out}(z)}{u(z)} = \frac{2\pi K_{DCO}T}{1-z^{-1}}
\end{equation}
Application of the bilinear transform to the DCO transfer function yields:
\begin{equation}
	\frac{\Phi_{out}(s)}{u(s)} = \frac{2\pi K_{DCO}T}{1-(1-sT)} = \frac{2\pi K_{DCO}}{s} 
\end{equation}
\subsubsection{Discrete-time PLL transfer function}
\begin{figure}[htb!]
	\center\include{./figs/discrete_pll}
	\caption{Discrete time PLL model.}
	\label{fig:discrete_pll2}
\end{figure}
\FloatBarrier
The transfer function for the discrete-time PLL can be computed in the z-domain, and also approximated continuously. The open loop z-domain transfer function is:
\begin{align}
\mathrm{OL}(z) = \mathrm{H}_{TDC}(z)\mathrm{H}_{LF}(z)\mathrm{H}_{DCO}(z)\mathrm{H}_{DIV}(z) = \\
2\pi K_{DCO}K_iT^2\frac{\mathrm{M}}{\mathrm{N}}\frac{\omega_p}{\omega_z}\frac{(1+\omega_zT)-z^{-1}}{(1+\omega_pT) - z^{-1}(3+2\omega_pT) + z^{-2}(3+\omega_pT) - z^{-3}}\label{eq:z_lf}
\end{align}
The closed loop z-domain PLL phase transfer function is:
\begin{align}
\frac{\Phi_{out}(z)}{\Phi_{ref}(z)} = \frac{\mathrm{H}_{DIV}(z)^{-1}\mathrm{OL}(z)}{1+\mathrm{OL}(z)} = \\
\frac{2\pi K_{DCO}K_iT^2\mathrm{M}\frac{\omega_p}{\omega_z}(1+\omega_zT)-z^{-1}}{(1+\omega_pT + 2\pi K_{DCO}K_iT^2\frac{\mathrm{M}}{\mathrm{N}}\frac{\omega_p}{\omega_z}(1+\omega_zT))- z^{-1}(3+2\omega_pT+2\pi K_{DCO}K_iT^2\frac{\mathrm{M}}{\mathrm{N}}\frac{\omega_p}{\omega_z})+ z^{-2}(3+\omega_pT) - z^{-3}}
\end{align}
The s-domain approximation of the transfer function is:
\begin{align}
\mathrm{OL}(s) = \mathrm{H}_{TDC}(s)\mathrm{H}_{LF}(s)\mathrm{H}_{DCO}(s)\mathrm{H}_{DIV}(s) = \frac{\mathrm{M}}{\mathrm{N}}\frac{K_{DCO}K_i}{s^2} \frac{\left(\frac{s}{\omega_z} + 1\right)}{\left(\frac{s}{\omega_p} + 1\right)}
\end{align}
And in closed loop configuration the PLL phase transfer function is:
\begin{align}
\frac{\Phi_{out}(z)}{\Phi_{ref}(z)} = \frac{\mathrm{H}_{DIV}(z)^{-1}\mathrm{OL}(z)}{1+\mathrm{OL}(z)} = \frac{\mathrm{M}K_{DCO}K_i\left(\frac{s}{\omega_z} + 1\right)}{s^3\frac{1}{\omega_z} + s^2 + \frac{\mathrm{M}}{\mathrm{N}}K_{DCO}K_i\left(\frac{s}{\omega_z} + 1\right)}
\end{align}
Incidentally, the s-domain approximation is significantly simpler and will is prefered in this paper for purposes of analysis.


\subsection{PLL Noise} \label{pn_theory}
The predominant sources of noise in the discrete-time ADPLL are chiefly quantization (in the TDC, loop filter, and DCO), along with thermal noise (in the DCO, divider and TDC). The noise generated by these quantization sources will be discussed in the following sections.

\subsubsection{TDC noise}
The predominant phase noise source in the TDC is due to quantization. A straightforward approach to model quantization noise is to utilize the model of figure \ref{fig:tdc_add_pn} to represent quantization.
\hspace{-20em}\begin{figure}[htb!]
    \centering
    \begin{subfigure}{0.5\textwidth}
        \centering
        \include{./figs/tdc}
        \caption{TDC Model.}
        \label{fig:tdc1}
    \end{subfigure}%
    \begin{subfigure}{0.5\textwidth}
        \centering
        \include{./figs/tdc_quant}
        \caption{TDC additive noise model.}
        \label{fig:tdc_add_pn}
    \end{subfigure}
    % \caption{Approximate model for ring oscillator inverter delay cell.}
    \label{fig:tdc_pn_model}
\end{figure}
\FloatBarrier
Using this model, the quantized signal $e_\Phi$[n] is the sum of the its unquantized representation $\Phi_e\frac{\mathrm{M}}{2\pi}$ with a quantization error signal $\mathrm{q}_{TDC}[n]$. Figure \ref{fig:quantization} illustrates this process.
\begin{figure}[htb!]
	\center\include{./figs/quantization}
	\caption{Quantization as via additive error signal.}
	\label{fig:quantization}
\end{figure}
\FloatBarrier
The quantization noise signal has the statistical property that it is uniformly distributed in the range $[-\Delta/2, \Delta/2]$, i.e. $P_q(Q=q) =\mathrm{U}(-\Delta/2, \Delta/2)$ if $\Delta$ is the quantization step size. The power of the TDC quantization noise signal is:
\begin{equation}\label{eq:tdc_noise}
\sigma_{q_{TDC}}^2 = \int_{-\infty}^\infty q^2P_q(Q=q)dq =  \int_{-\Delta/2}^{\Delta/2}\frac{q^2}{\Delta}dq = \frac{\Delta^2}{12}
\end{equation}
Since $e_\Phi$[n] is digital signal, the minimum step size is $\Delta$=1 LSB. The TDC quantization noise power is therefore $\sigma_{q_{TDC}}^2 = 1/12$ LSB$^2$. The po
If the quantization noise is assumed to be white, and the TDC is sampled at $f_{ref}$, the quantization PSD is:
\begin{equation}
S_{q_{TDC}} = \frac{P_{q_{TDC}}}{\Delta f} = \frac{\sigma_{q_{TDC}}^2}{f_{ref}} = \frac{\Delta^2}{12f_{ref}} = \frac{1}{12f_{ref}} \hspace{1em}\frac{[\text{LSB}]^2}{[\text{Hz}]}
\end{equation}

\subsubsection{DCO noise}
\begin{figure}[htb!]
	\center\include{./figs/dco_noise}
	\caption{DCO addative noise model.}
	\label{fig:quantization}
\end{figure}
\FloatBarrier
Noise in the DCO is from quantization of the oscillator tuning word (OTW), and from thermal and stochastic sources. In the digital PLL, the OTW is quantized in loop filter, so this source of noise will be analyzed in the loop filter section. Thus oscillator thermal noise will be considered.
\subsubsection{Divider noise}

\subsubsection{Loop filter noise}

\subsubsection{PLL output-referred noise}\label{pn_noise_psd}
In terms of analysis, PLL noise referred to the PLL output is of most interest. In this case, the noise is defined in terms of phase noise $\Phi_{n}$, or an unwanted added component to the oscillator phase signal $\Phi_{osc}=\omega_{osc}t$. The PLL output phase signal $\Phi_{out}$ is therefore:
\begin{equation}
	\Phi_{out}(t) = \Phi_{osc}(t) + \Phi_{n}(t) = \omega_{osc}t + \Phi_{n}(t) 
\end{equation}
In analyzing phase noise, the noise power spectral density of the PLL output is of most interest. To compute this, an output voltage waveform of the PLL must defined. Given an amplitude $A_0$:
\begin{equation}
V_{out} = \Re\left(A_0e^{j\Phi_{out}(t)}\right) = \Re\left(A_0e^{j\omega_{osc}t}e^{j\Phi_{n}(t)}\right)
\end{equation}
Assuming the phase noise signal is zero mean, $\mathbb{E}[\Phi_{n}(t)]=0$, and the power of phase noise signal is small, $\mathrm{Var}[\Phi_{n}(t)] << 1$, then the approximation $e^{j\Phi_{n}(t)} = 1 + j\Phi_{n}(t)$ can be applied.
\begin{align}
V_{out} = \Re\left(A_0e^{j\omega_{osc}t}e^{j\Phi_{n}(t)}\right) = \Re\left(A_0e^{j\omega_{osc}t} +j\Phi_{n}(t)A_0e^{j\omega_{osc}t}\right)\\
= A_0\cos(\omega_{osc}t) - \Phi_{n}(t)A_0\sin(\omega_{osc}t)
\end{align}
The result is a carrier cosine signal, and an orthogonal sine signal modulated by the phase noise $\Phi_{n}$. From this, the spectral density of the phase noise relative to the carrier can be estimated. Power spectral density is computed as such, assuming the carrier and the phase noise signal components are uncorrelated:
\begin{equation}
S_{V_{out}} = |\mathcal{F}\{V_{out}(t)\}|^2 = A_0^2|\mathcal{F}\{\cos(\omega_{osc}t)\}|^2 + A_0^2|\Phi_{n}(\omega)*\mathcal{F}\{\sin(\omega_{osc}t)\}|^2
\end{equation}
If single side band (SSB) noise power spectral density $\mathcal{L}(\Delta f)$ is defined as the phase noise PSD at offset $\Delta f$ from the carrier frequency $f_{osc}$, normalized to the carrier power:
\begin{equation}
\mathcal{L}(\Delta f) = |\Phi_{n}(2\pi\Delta f)|^2 = |\mathcal{F}\{\Phi_{n}(t)\}|^2= S_{\Phi_{n}}(\Delta f)
\end{equation}
Thus, the PLL output PSD noise relative to the carrier can be computed as the PSD of the phase noise signal $\Phi_{n}(t)$.

\subsubsection{PLL noise sensitivity transfer functions}
Having models for noise of generated by each PLL component, noise sensitivity transfer functions must be computer to refer each noise source to the PLL output in terms of phase. After which, the output noise PSD can be inferred based on the output phase signal, following the theory of section \ref{pn_noise_psd}. An important assumption is made, in that every noise source within the PLL is independent, so that their individual noise powers can be summed at the PLL output to compute the overall PLL output noise.

 and a method to calculate noise power spectral density from the output phase signal


All noise uncorrelated.

Plot of BW vs 
fasf
Generic theory of PLL
Discrete PLL
Noise theory
